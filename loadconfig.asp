<!-- #include file="common.asp" -->
<%
dim lcn,lrs
set lcn=server.CreateObject("ADODB.Connection")
set lrs=server.CreateObject("ADODB.Recordset")

CreateConn lcn,dbtype
checkuser lcn,lrs,false

'================================
'================================
'================================
'Load Web Master Global Settings
'================================
'================================
'================================
lrs.Open Replace(sql_loadconfig_config,"{0}",wm_id),lcn,0,1,1

status=lrs("status")
if clng(status and 1)<>0 then	'留言本开启
	StatusOpen=true
else
	StatusOpen=false
end if
if clng(status and 2)<>0 then	'留言权限开启
	StatusWrite=true
else
	StatusWrite=false
end if
if clng(status and 4)<>0 then	'搜索权限开启
	StatusSearch=true
else
	StatusSearch=false
end if
if clng(status and 32)<>0 then	'用户登录权限开启
	StatusLogin=true
else
	StatusLogin=false
end if
if clng(status and 256)<>0 then	'开启统计
	StatusStatistics=true
else
	StatusStatistics=false
end if

web_StatusOpen=StatusOpen
web_StatusWrite=StatusWrite
web_StatusSearch=StatusSearch
web_StatusStatistics=StatusStatistics

web_IPConStatus=lrs("ipconstatus")	'IP屏蔽策略，低4位用于IPv4，高4位用于IPv6
web_IPv4ConStatus=web_IPConStatus mod 16
if web_IPv4ConStatus<0 or web_IPv4ConStatus>2 then web_IPv4ConStatus=0
web_IPv6ConStatus=web_IPConStatus \ 16
if web_IPv6ConStatus<0 or web_IPv6ConStatus>2 then web_IPv6ConStatus=0


'========HTML权限设定========
web_AdminHTMLSupport=false
web_AdminUBBSupport=false
web_AdminAllowNewLine=false

web_HTMLSupport=false
web_UBBSupport=false
web_AllowNewLine=false

dim web_adminlimit,web_guestlimit
web_adminlimit=lrs("adminhtml")
if clng(web_adminlimit and 1) <>0 then web_AdminHTMLSupport=true		'管理员回复、公告默认是否支持HTML True:是 False:否
if clng(web_adminlimit and 2) <>0 then web_AdminUBBSupport=true		'管理员回复、公告默认是否支持UBB标记
if clng(web_adminlimit and 4) <>0 then web_AdminAllowNewLine=true	'管理员不支持HTML和UBB时，默认是否允许回车换行

web_guestlimit=lrs("guesthtml")
if clng(web_guestlimit and 1) <>0 then web_HTMLSupport=true			'访客留言是否支持HTML
if clng(web_guestlimit and 2) <>0 then web_UBBSupport=true			'访客留言是否支持UBB标记
if clng(web_guestlimit and 4) <>0 then web_AllowNewLine=true			'访客不支持HTML和UBB时，是否允许回车换行


'========安全性设置========
web_ShowIP=lrs("showip")			'留言者IP显示，低4位用于IPv4，高4位用于IPv6
web_ShowIPv4=web_ShowIP mod 16
web_ShowIPv6=web_ShowIP \ 16
web_AdminShowIP=lrs("adminshowip")	'为管理员显示IP位数，低4位用于IPv4，高4位用于IPv6
web_AdminShowIPv4=web_AdminShowIP mod 16
web_AdminShowIPv6=web_AdminShowIP \ 16
web_AdminShowOriginalIP=lrs("adminshoworiginalip")	'为管理员显示原始IP位数，低4位用于IPv4，高4位用于IPv6
web_AdminShowOriginalIPv4=web_AdminShowOriginalIP mod 16
web_AdminShowOriginalIPv6=web_AdminShowOriginalIP \ 16

web_VcodeCount=clng(lrs("vcodecount") and &H0F)		'登录验证码长度
web_WriteVcodeCount=clng(lrs("vcodecount") and &HF0) \ &H10		'留言验证码长度

'========邮件设置========
web_MailFlag=lrs("mailflag")
if clng(web_Mailflag and 1)<>0 then web_MailNewInform=true else web_MailNewInform=false		'新留言通知
if clng(web_Mailflag and 2)<>0 then web_MailReplyInform=true else web_MailReplyInform=false		'回复通知
if clng(web_MailFlag and 4)<>0 then MailComponent="cdo" else MailComponent="jmail"

'========web UBB Flags========
web_UbbFlag=lrs("ubbflag")
if clng(web_UbbFlag and 1)<>0 then web_UbbFlag_image=true else web_UbbFlag_image=false
if clng(web_UbbFlag and 2)<>0 then web_UbbFlag_url=true else web_UbbFlag_url=false
if clng(web_UbbFlag and 4)<>0 then web_UbbFlag_autourl=true else web_UbbFlag_autourl=false
if clng(web_UbbFlag and 8)<>0 then web_UbbFlag_player=true else web_UbbFlag_player=false
if clng(web_UbbFlag and 16)<>0 then web_UbbFlag_paragraph=true else web_UbbFlag_paragraph=false
if clng(web_UbbFlag and 32)<>0 then web_UbbFlag_fontstyle=true else web_UbbFlag_fontstyle=false
if clng(web_UbbFlag and 64)<>0 then web_UbbFlag_fontcolor=true else web_UbbFlag_fontcolor=false
if clng(web_UbbFlag and 128)<>0 then web_UbbFlag_alignment=true else web_UbbFlag_alignment=false
'if clng(web_UbbFlag and 256)<>0 then web_UbbFlag_movement=true else web_UbbFlag_movement=false
'if clng(web_UbbFlag and 512)<>0 then web_UbbFlag_cssfilter=true else web_UbbFlag_cssfilter=false
if clng(web_UbbFlag and 1024)<>0 then web_UbbFlag_face=true else web_UbbFlag_face=false

'========================
lrs.Close
lrs.Open Replace(sql_loadconfig_floodconfig,"{0}",wm_id),lcn,0,1,1
web_flood_minwait=abs(lrs.Fields("minwait"))
web_flood_searchrange=abs(lrs.Fields("searchrange"))
web_flood_searchflag=lrs.Fields("searchflag")
if clng(web_flood_searchflag and 1)<>0 then web_flood_sfnewword=true else web_flood_sfnewword=false
if clng(web_flood_searchflag and 2)<>0 then web_flood_sfnewreply=true else web_flood_sfnewreply=false
if clng(web_flood_searchflag and 16)<>0 then web_flood_include=true else web_flood_include=false
if clng(web_flood_searchflag and 32)<>0 then web_flood_equal=true else web_flood_equal=false
if clng(web_flood_searchflag and 256)<>0 then web_flood_sititle=true else web_flood_sititle=false
if clng(web_flood_searchflag and 512)<>0 then web_flood_sicontent=true else web_flood_sicontent=false

lrs.Close

'================================
'================================
'================================
'Load User Settings
'================================
'================================
'================================
lrs.Open Replace(sql_loadconfig_config,"{0}",adminid),lcn,0,1,1

status=lrs("status")
if StatusOpen=true then
	if clng(status and 1)<>0 then	'留言本开启
		StatusOpen=true
	else
		StatusOpen=false
	end if
end if
if StatusWrite=true then
	if clng(status and 2)<>0 then	'留言权限开启
		StatusWrite=true
	else
		StatusWrite=false
	end if
end if
if StatusSearch=true then
	if clng(status and 4)<>0 then	'搜索权限开启
		StatusSearch=true
	else
		StatusSearch=false
	end if
end if
if clng(status and 8)<>0 then	'访客头像显示开关
	StatusShowHead=true
else
	StatusShowHead=false
end if
if clng(status and 16)<>0 then	'留言需要审核
	StatusNeedAudit=true
else
	StatusNeedAudit=false
end if
if clng(status and 32)<>0 then	'允许悄悄话
	StatusWhisper=true
else
	StatusWhisper=false
end if
if clng(status and 64)<>0 then	'允许访客加密悄悄话回复
	StatusEncryptWhisper=true
else
	StatusEncryptWhisper=false
end if
if clng(status and 128)<>0 then	'允许访客回复
	StatusGuestReply=true
else
	StatusGuestReply=false
end if
if StatusStatistics=true then
	if clng(status and 256)<>0 then	'开启统计
		StatusStatistics=true
	else
		StatusStatistics=false
	end if
end if

IPConStatus=lrs("ipconstatus")	'IP屏蔽策略，低4位用于IPv4，高4位用于IPv6
IPv4ConStatus=IPConStatus mod 16
if IPv4ConStatus<0 or IPv4ConStatus>2 then IPv4ConStatus=0
IPv6ConStatus=IPConStatus \ 16
if IPv6ConStatus<0 or IPv6ConStatus>2 then IPv6ConStatus=0

HomeLogo=lrs("homelogo")			'网站Logo地址
HomeName=lrs("homename")			'网站名称
HomeAddr=lrs("homeaddr")	'网站地址



'========HTML权限设定========
AdminHTMLSupport=false
AdminUBBSupport=false
AdminAllowNewLine=false
AdminViewCode=false

HTMLSupport=false
UBBSupport=false
AllowNewLine=false

dim adminlimit,guestlimit
adminlimit=lrs("adminhtml")
if clng(adminlimit and 1) <>0 then AdminHTMLSupport=true		'管理员回复、公告默认是否支持HTML True:是 False:否
if clng(adminlimit and 2) <>0 then AdminUBBSupport=true		'管理员回复、公告默认是否支持UBB标记
if clng(adminlimit and 4) <>0 then AdminAllowNewLine=true	'管理员不支持HTML和UBB时，默认是否允许回车换行
if clng(adminlimit and 8) <>0 then AdminViewCode=true		'为管理员显示实际HTML代码

guestlimit=lrs("guesthtml")
if clng(guestlimit and 1) <>0 then HTMLSupport=true			'访客留言是否支持HTML
if clng(guestlimit and 2) <>0 then UBBSupport=true			'访客留言是否支持UBB标记
if clng(guestlimit and 4) <>0 then AllowNewLine=true			'访客不支持HTML和UBB时，是否允许回车换行


'========安全性设置========
AdminTimeOut=lrs("admintimeout")		'管理员登录超时(分)
ShowIP=lrs("showip")			'留言者IP显示，低4位用于IPv4，高4位用于IPv6
ShowIPv4=ShowIP mod 16
ShowIPv6=ShowIP \ 16
AdminShowIP=lrs("adminshowip")	'为管理员显示IP位数，低4位用于IPv4，高4位用于IPv6
AdminShowIPv4=AdminShowIP mod 16
AdminShowIPv6=AdminShowIP \ 16
AdminShowOriginalIP=lrs("adminshoworiginalip")	'为管理员显示原始IP位数，低4位用于IPv4，高4位用于IPv6
AdminShowOriginalIPv4=AdminShowOriginalIP mod 16
AdminShowOriginalIPv6=AdminShowOriginalIP \ 16

if web_ShowIPv4<ShowIPv4 then ShowIPv4=web_ShowIPv4		'WebMaster设置优先
if web_ShowIPv6<ShowIPv6 then ShowIPv6=web_ShowIPv6		'WebMaster设置优先
if web_AdminShowIPv4<AdminShowIPv4 then AdminShowIPv4=web_AdminShowIPv4		'WebMaster设置优先
if web_AdminShowIPv6<AdminShowIPv6 then AdminShowIPv6=web_AdminShowIPv6		'WebMaster设置优先
if web_AdminShowOriginalIPv4<AdminShowOriginalIPv4 then AdminShowOriginalIPv4=web_AdminShowOriginalIPv4		'WebMaster设置优先
if web_AdminShowOriginalIPv6<AdminShowOriginalIPv6 then AdminShowOriginalIPv6=web_AdminShowOriginalIPv6		'WebMaster设置优先

VcodeCount=clng(lrs("vcodecount") and &H0F)		'登录验证码长度
if VcodeCount<web_VcodeCount then VcodeCount=web_VcodeCount		'WebMaster设置优先

WriteVcodeCount=clng(lrs("vcodecount") and &HF0) \ &H10		'留言验证码长度
if WriteVcodeCount<web_WriteVcodeCount then WriteVcodeCount=web_WriteVcodeCount		'WebMaster设置优先

'========邮件设置========
MailFlag=lrs("mailflag")
if clng(Mailflag and 1)<>0 then MailNewInform=true else MailNewInform=false		'新留言通知
if clng(Mailflag and 2)<>0 then MailReplyInform=true else MailReplyInform=false		'回复通知
MailReceive=lrs("mailreceive")			'新留言通知接收地址
MailFrom=lrs("mailfrom")				'发件人地址
MailSmtpServer=lrs("mailsmtpserver")	'发件人SMTP服务器地址
MailUserId=lrs("mailuserid")			'登录用户名
MailUserPass=lrs("mailuserpass")		'登录密码
MailLevel=lrs("maillevel")				'紧急程度

'========界面设置========
CssFontFamily=lrs("cssfontfamily")
CssFontSize=lrs("cssfontsize")
CssLineHeight=lrs("csslineheight")

VisualFlag=lrs("visualflag")
if clng(VisualFlag and 1)<>0 then ReplyInWord=true else ReplyInWord=false					'回复内嵌于留言
if clng(VisualFlag and 2)<>0 then ShowUbbTool=true else ShowUbbTool=false					'显示UBB工具栏
if clng(VisualFlag and 4)<>0 then ShowTopPageList=true else ShowTopPageList=false			'上方显示分页
if clng(VisualFlag and 8)<>0 then ShowBottomPageList=true else ShowBottomPageList=false		'下方显示分页
if ShowTopPageList=false and ShowBottomPageList=false then ShowBottomPageList=true
if clng(VisualFlag and 16)<>0 then ShowTopSearchBox=true else ShowTopSearchBox=false		'上方显示搜索
if clng(VisualFlag and 32)<>0 then ShowBottomSearchBox=true else ShowBottomSearchBox=false	'下方显示搜索
if ShowTopSearchBox=false and ShowBottomSearchBox=false then ShowBottomSearchBox=true
if clng(VisualFlag and 64)<>0 then ShowAdvPageList=true else ShowAdvPageList=false			'区段式分页
if clng(VisualFlag and 128)<>0 then HideHidden=true else HideHidden=false					'隐藏内容被隐藏的留言
if clng(VisualFlag and 256)<>0 then HideAudit=true else HideAudit=false						'隐藏待审核留言
if clng(VisualFlag and 512)<>0 then HideWhisper=true else HideWhisper=false					'隐藏版主未回复悄悄话
if clng(VisualFlag and 1024)<>0 then DisplayMode="forum" else DisplayMode="book"			'默认版面模式
if clng(VisualFlag and 2048)<>0 then LogoBannerMode=true else LogoBannerMode=false			'Logo显示模式

AdvPageListCount=lrs("advpagelistcount")	'区段式分页项数

'========UBB Flags========
UbbFlag=lrs("ubbflag")
if clng(UbbFlag and 1)<>0 then UbbFlag_image=true else UbbFlag_image=false
if clng(UbbFlag and 2)<>0 then UbbFlag_url=true else UbbFlag_url=false
if clng(UbbFlag and 4)<>0 then UbbFlag_autourl=true else UbbFlag_autourl=false
if clng(UbbFlag and 8)<>0 then UbbFlag_player=true else UbbFlag_player=false
if clng(UbbFlag and 16)<>0 then UbbFlag_paragraph=true else UbbFlag_paragraph=false
if clng(UbbFlag and 32)<>0 then UbbFlag_fontstyle=true else UbbFlag_fontstyle=false
if clng(UbbFlag and 64)<>0 then UbbFlag_fontcolor=true else UbbFlag_fontcolor=false
if clng(UbbFlag and 128)<>0 then UbbFlag_alignment=true else UbbFlag_alignment=false
'if clng(UbbFlag and 256)<>0 then UbbFlag_movement=true else UbbFlag_movement=false
'if clng(UbbFlag and 512)<>0 then UbbFlag_cssfilter=true else UbbFlag_cssfilter=false
if clng(UbbFlag and 1024)<>0 then UbbFlag_face=true else UbbFlag_face=false

TableAlign=lrs("tablealign")		'表格对齐方式 left:左对齐 center:居中 right:右对齐
TableWidth=lrs("tablewidth")		'表格宽度，可用百分比
TableLeftWidth=lrs("tableleftwidth")	'表格左方宽度，可用百分比
WindowSpace=lrs("windowspace")			'窗格区块间距

LeaveContentHeight=lrs("leavecontentheight")		'“留言内容”文本高度
SearchTextWidth=lrs("searchtextwidth")				'“留言搜索”文本宽度
ReplyTextHeight=lrs("replytextheight")				'回复、公告编辑框高度

ItemsPerPage=lrs("itemsperpage")		'每页显示的留言数
TitlesPerPage=lrs("titlesperpage")		'每页显示的标题数(论坛模式)
PicturesPerRow=lrs("picturesperrow")		'每行显示的头像数
FrequentFaceCount=lrs("frequentfacecount")	'少量载入的头像数
if FrequentFaceCount>FaceCount then FrequentFaceCount=FaceCount

PageControl=clng(lrs("pagecontrol"))
ShowBorder=false
ShowTitle=false
ShowContext=false
SelectContent=false
CopyContent=false
BeFramed=false
if clng(PageControl and 1)<> 0 then ShowBorder=true			'显示边框
if clng(PageControl and 2)<> 0 then ShowTitle=true			'显示标题栏
if clng(PageControl and 4)<> 0 then ShowContext=true		'显示右键菜单
if clng(PageControl and 8)<> 0 then SelectContent=true		'允许选择
if clng(PageControl and 16)<> 0 then CopyContent=true		'允许复制
if clng(PageControl and 32)<> 0 then BeFramed=true			'允许frame
if ShowBorder=true then
	TableBorderWidth=1
else
	TableBorderWidth=0
end if

WordsLimit=abs(lrs("wordslimit"))		'最大留言数

DelTip=false
DelReTip=false
DelSelTip=false
DelAdvTip=false
PassAuditTip=false
PassSelTip=false
PubWhisperTip=false
Bring2TopTip=false
Lock2TopTip=false
ReorderTip=false
DelConfirm=lrs("delconfirm")
if clng(DelConfirm and 1)<>0 then DelTip=true
if clng(DelConfirm and 2)<>0 then DelReTip=true
if clng(DelConfirm and 4)<>0 then DelSelTip=true
if clng(DelConfirm and 8)<>0 then DelAdvTip=true
if clng(DelConfirm and 16)<>0 then PassAuditTip=true
if clng(DelConfirm and 32)<>0 then PassSelTip=true
if clng(DelConfirm and 64)<>0 then PubWhisperTip=true
if clng(DelConfirm and 128)<>0 then Bring2TopTip=true
if clng(DelConfirm and 256)<>0 then Lock2TopTip=true
if clng(DelConfirm and 512)<>0 then ReorderTip=true

dim styleid
styleid=lrs("styleid")
lrs.Close
lrs.Open Replace(sql_loadconfig_style,"{0}",styleid),lcn,0,1,1
if lrs.EOF=true then
	lrs.Close
	lrs.Open sql_loadconfig_top1style,lcn,0,1,1
end if

ThemePath=lrs("themepath")

lrs.Close
lrs.Open Replace(sql_loadconfig_floodconfig,"{0}",adminid),lcn,0,1,1
flood_minwait=abs(lrs.Fields("minwait"))
flood_searchrange=abs(lrs.Fields("searchrange"))
flood_searchflag=lrs.Fields("searchflag")
if clng(flood_searchflag and 1)<>0 then flood_sfnewword=true else flood_sfnewword=false
if clng(flood_searchflag and 2)<>0 then flood_sfnewreply=true else flood_sfnewreply=false
if clng(flood_searchflag and 16)<>0 then flood_include=true else flood_include=false
if clng(flood_searchflag and 32)<>0 then flood_equal=true else flood_equal=false
if clng(flood_searchflag and 256)<>0 then flood_sititle=true else flood_sititle=false
if clng(flood_searchflag and 512)<>0 then flood_sicontent=true else flood_sicontent=false

lrs.Close : lcn.Close : set lrs=nothing : set lcn=nothing
%>